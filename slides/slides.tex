% Packages
% sudo tlmgr install silence appendixnumberbeamer fira fontaxes mwe noto csquotes babel helvet
%--- Preamble ---------------------------------------------------------%
% Load LaTeX packages
\documentclass[aspectratio=169]{beamer}                    % supports floating text in any location
%\usetheme[noto, showmaxslides, darkmode]{pureminimalistic}
\usetheme[noto, lightmode]{pureminimalistic}
\graphicspath{{logos/}}

% This will add an "Outline" Table of Contents for each section
% uncomment if desired
%\AtBeginSection[]{%
%	\frame<beamer>{
%		\frametitle{Outline \secname}
%		\setcounter{tocdepth}{10}
%		\tableofcontents[currentsubsection, sectionstyle=hide/hide, subsectionstyle=show/show/hide, subsubsectionstyle=show/show/show/hide] % Show current section and current section's subsections, but hide other section's section and subsections!
%	}
%}

\usepackage[utf8]{inputenc}
\usepackage{csquotes,xpatch}% recommended
%\usepackage[english]{babel}
\usepackage[american]{babel}
\babelprovide[import, main]{english}
\usepackage{tikz}
\usepackage{hyphenat}
\usepackage{graphicx}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{bookmark}
\usepackage{multicol} % for multicolumn Table of Contents

% Hyperlinks
\usepackage{hyperref}
\hypersetup{%
	colorlinks=true,
	bookmarks=true,
	bookmarksdepth=4,
	bookmarksnumbered=true,
	bookmarksopen=true,
	linkbordercolor=black,
	allcolors=pureminimalistic@text@pumasblue,
	pdfborderstyle={/S/U/W 1}% border style will be underline of width 1pt
}

% Math
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{wasysym}

% Algorithms
\usepackage[ruled,vlined,english]{algorithm2e}
\SetKwFor{For}{for}{}{}

% Code
\usepackage{listings}
\usepackage{lstbayes} % Stan
\lstset{
	language=R,
	moredelim=**[is][\color{blue}]{@}{@}}

% strike through text
\usepackage[normalem]{ulem}

% Plots
\usepackage{pgfplots}
\graphicspath{{logos}{images}}
\pgfplotsset{height=6cm, % only if needed
	width=12cm,
	compat=1.17,
	legend style = {fill = white, draw = black},
	contour/every contour label/.style={
			every node/.style={mapped color!50!white,fill=white}}
}
\usepackage{tikz}
\usepackage{tikzsymbols} % Metropolis Little Man
\usetikzlibrary{shapes}
\usetikzlibrary{arrows}
\usetikzlibrary{positioning}
\usetikzlibrary{calc}
\usetikzlibrary{automata} % State in Markov Chains
\usetikzlibrary{intersections}
\usetikzlibrary{backgrounds}
\usetikzlibrary{external}
\tikzsetfigurename{fig}
\tikzexternalize[prefix=tikz/]
% Sample Space subfigures
\usepackage{subfigure}
\definecolor{gray80}{gray}{0.8}
\definecolor{gray60}{gray}{0.6}
\definecolor{colorA}{rgb}{102, 255, 255}
\definecolor{colorB}{rgb}{0, 102, 255}
\usepackage{transparent}
% Multilevel Modeling
\usepackage{adjustbox}
\newcommand*{\offset}{0.025}
\definecolor{light}{RGB}{188, 188, 220}
\definecolor{mid}{RGB}{124, 124, 185}
\definecolor{dark}{RGB}{39, 39, 143}
\definecolor{highlight}{RGB}{180, 31, 180}
% Animations
\usepackage{media9}
\usepackage{multimedia}
\addmediapath{animations}

% \renewcommand{\pageword}{}
% \renewcommand{\logoheader}{\vspace{1.5em}}

% Bibliography
\usepackage[
	%    natbib=true,
	backend=biber,
	%    style=abnt,
	%    style=authoryear-comp,
	%    style=authoryear,
	%    style=ieee,
	%    style=acm,
	%    style=apalike,
	%    style=siam,
	%    style=ieeetr,
	%    style=plain,
	%    style=vancouver,
	style=apa,
	doi=true,
	eprint=false,
	hyperref=true,
	url=true]
{biblatex}
\addbibresource{references.bib}
% biblatex
\renewcommand*{\bibfont}{\footnotesize}
% natbib
%\def\bibfont{\footnotesize}

%% this makes it possible to add backup slides, without counting them
\usepackage{appendixnumberbeamer}
\renewcommand{\appendixname}{\texorpdfstring{\translate{appendix}}{appendix}}
\renewcommand{\inserttotalframenumber}{\pageref{lastslide}}
% logos

% footer page
\renewcommand{\pageword}{Slide}

% Math Font Default (Fira is strange)
\renewcommand\mathfamilydefault{\rmdefault}

% footnotes
\renewcommand{\thefootnote}{\roman{footnote}}

% if loaded after begin{document} a warning will appear: "pdfauthor already used"
\title[Bayesian Workshop]{Bayesian Workshop: How to use Bayesian methods in Pumas}
\author[\textcolor{pureminimalistic@text@pumasblue}{PumasAI}]{Jose Storopoli and Mohamed Tarek \texttt{\{jose.storopoli,mohamed\}@pumas.ai}}
\institute{\textcolor{pureminimalistic@text@pumasblue}{PumasAI}}
\date{\today}


%%%% Maths crap
\newtheorem{theo}{Theorem}[]
\newtheorem{defn}{Definition}[]
\newtheorem{question}{Question}[]
\newtheorem{idea}{Idea}[]
\newtheorem{property}{Property}[]


\begin{document}
%--- Title Page -------------------------------------------------------%
\maketitle

%--- Table of Contents-------------------------------------------------%
% For longer table of contents, I find it cleaner to
% use no footline.
\setcounter{tocdepth}{1}
\begin{frame}[plain, noframenumbering]{Outline}
	\begin{multicols}{2}
		\tableofcontents
	\end{multicols}
\end{frame}

%--- Distributions ----------------------------------------------------%

\tikzset{
	declare function={
			discreteuniform(\a,\b)=1/(\b-\a+1);%
			binomial(\n,\p)=\n!/(x!*(\n-x)!)*\p^x*(1-\p)^(\n-x);%
			poisson(\l)=(\l^x)*exp(-\l)/(x!);%
			negativebinomial(\r,\p)=((x+\r-1)!/((\r-1)!*x!))*((1-\p)^x*\p^\r);%
			continuousuniform(\a,\b)=1/(\b-\a);%
			gaussian(\m,\s)=1/(\s*sqrt(2*pi))*exp(-((x-\m)^2)/(2*\s^2));%
			lognormal(\m,\s)=1/(x*\s*sqrt(2*pi))*exp(-((ln(x)-\m)^2)/(2*\s^2));%
			exponential(\l)=\l*exp(-\l*x);%
			gamma(\z)=2.506628274631*sqrt(1/\z)+ 0.20888568*(1/\z)^(1.5)+ 0.00870357*(1/\z)^(2.5)- (174.2106599*(1/\z)^(3.5))/25920- (715.6423511*(1/\z)^(4.5))/1244160)*exp((-ln(1/\z)-1)*\z;%
			gammadist(\a,\t)=(x^(\a-1))*exp(-x/\t)*gamma(\a)*\t^\a;%
			student(\n)=gamma((\n+1)/2.)/(sqrt(\n*pi)*gamma(\n/2.))*((1+(x*x)/\n)^(-(\n+1)/2.));%
			cauchy(\m,\s)=(1/(pi*\s*(1+((x-\m)/\s)^2)));%
			beta(\a,\b)=(x^(\a-1)*(1-x)^(\b-1)/((gamma(\a)*gamma(\b))/gamma(\a+\b));%
			binormal(\ma,\sa,\mb,\sb,\ro)=exp(-(((x-\ma)/\sa)^2+((y-\mb)/\sb)^2-(2*\ro)*((x-\ma)/\sa)*((y-\mb)/\sb))/(2*(1-\ro^2)))/(2*pi*\sa*\sb*(1-\ro^2)^0.5);%
			conditionalbinormal(\yc,\ma,\sa,\mb,\sb,\ro)=exp(-(((x-\ma)/\sa)^2+((\yc-\mb)/\sb)^2-(2*\ro)*((x-\ma)/\sa)*((\yc-\mb)/\sb))/(2*(1-\ro^2)))/(2*pi*\sa*\sb*(1-\ro^2)^0.5);%
			sumtwonormals(\ma,\sa,\wa,\mb,\sb,\wb)=(\wa*gaussian(\ma,\sa))+(\wb*gaussian(\mb,\sb));%
			normcdf(\m,\s)=1/(1 + exp(-0.07056*((x-\m)/\s)^3 - 1.5976*(x-\m)/\s));%
		}
}

%--- Files ----------------------------------------------------------%
\include{00-Pumas}
\include{01-Bayesian_Statistics}
\include{02-Priors}
\include{03-Pumas_Setup}
\include{04-Bayesian_Logistic_Regression}
\include{05-Bayesian_PK}
\include{06-Hierarchical_Models}
\include{07-Bayesian_PopPK}
\include{08-Bayesian_PopPKPD}
\include{09-MCMC}
\include{10-Marginal_MCMC}
\include{11-Convergence}
\include{12-Posterior_Postprocessing}
\include{13-Model_Comparison_and_Cross-Validation}
\include{14-Software-Comparison}
\label{lastslide}

%--- References ----------------------------------------------------------%
\begingroup
\renewcommand{\insertframenumber}{}
\renewcommand{\pageword}{}
\begin{frame}[allowframebreaks, noframenumbering]{References}
	\printbibliography
\end{frame}

%--- Appendix ----------------------------------------------------------%
\appendix % do not count the following slides for the total number
\section*{Backup Slides}
\begin{frame}[noframenumbering]
	\centering
	\vfill
	{\fontsize{40}{50}\selectfont Backup Slides}
	\vfill
\end{frame}

%--- Backup Files ----------------------------------------------------------%
\include{backup-Statistical_Distributions}
\include{backup-Logistic_Regression_Coeff}
\include{backup-misc}
\endgroup

\end{document}
